#!/bin/bash

# create .ssh folder if missing
if [ ! -d ~/.ssh ]; then
    echo Creating the ~/.ssh directory for SSH client configuration...
    mkdir ~/.ssh
else
    echo The ~/.ssh directory for SSH client configuration already exists.
fi

# create config file
echo Appending SSH connection configuration to ~/.ssh/config
cat << EOF >> ~/.ssh/config
################################################################################################
# oneAPI DevCloud SSH config
################################################################################################
Host devcloud
User u171943
IdentityFile ~/.ssh/devcloud-access-key-171943.txt
ProxyCommand ssh -T -i ~/.ssh/devcloud-access-key-171943.txt guest@ssh.devcloud.intel.com

Host devcloud.proxy
User u171943
Port 4022
IdentityFile ~/.ssh/devcloud-access-key-171943.txt
ProxyCommand ssh -T devcloud-via-proxy

# If you must route outgoing SSH connection via a corporate proxy,
# replace PROXY_HOSTNAME and PORT below with the values provided by
# your network administrator.
Host devcloud-via-proxy
User guest
Hostname ssh.devcloud.intel.com
IdentityFile ~/.ssh/devcloud-access-key-171943.txt
LocalForward 4022 c009:22
ProxyCommand nc -x PROXY_HOSTNAME:PORT %h %p
################################################################################################

################################################################################################
# DevCloud VSCode config
################################################################################################
Host devcloud-vscode
UserKnownHostsFile /dev/null
StrictHostKeyChecking no
Hostname localhost
User u171943
Port 5022
IdentityFile ~/.ssh/devcloud-access-key-171943.txt
################################################################################################

################################################################################################
# SSH Tunnel config
################################################################################################
Host *.aidevcloud
User u171943
IdentityFile ~/.ssh/devcloud-access-key-171943.txt
ProxyCommand ssh -T devcloud nc %h %p
LocalForward 5022 localhost:22
LocalForward 5901 localhost:5901
################################################################################################

EOF

# create private key file
echo Creating the private SSH key ~/.ssh/devcloud-access-key-171943.txt
echo Important: this file is your access key, keep it safe like you would a password.
cat << EOF > ~/.ssh/devcloud-access-key-171943.txt
-----BEGIN OPENSSH PRIVATE KEY-----
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
/rJhiq5XVvoPbfAAAAB3UxNzE5NDMBAgM=
-----END OPENSSH PRIVATE KEY-----

EOF

# update permissions to the private key file
chmod 600 ~/.ssh/devcloud-access-key-171943.txt

echo Done! Now you can access Intel DevCloud by running 'ssh devcloud' or, if you are behind a proxy, 'ssh devcloud.proxy'
